{"version":3,"sources":["../../src/pages/home/home.module.ts","../../src/pages/home/home.ts"],"names":[],"mappings":"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","file":"5.js","sourcesContent":["import { NgModule } from '@angular/core';\nimport { IonicPageModule } from 'ionic-angular';\nimport { HomePage } from './home';\n\nimport { PipesModule } from '../../pipes/pipes.module';\n\n@NgModule({\n  declarations: [\n    HomePage,\n  ],\n  imports: [\n    IonicPageModule.forChild(HomePage),\n    PipesModule\n  ],\n  exports: [\n    HomePage\n  ]\n})\nexport class HomeModule {}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/home/home.module.ts","import { Component } from '@angular/core';\nimport { NavController, LoadingController, Loading, AlertController } from 'ionic-angular';\n\nimport { AngularFireDatabase, FirebaseObjectObservable } from 'angularfire2/database';\n\n//moment.js library for handling timestamps\nimport * as moment from 'moment';\nimport 'moment/locale/pt-br';\n\nimport { TimeService } from '../../providers/time-service';\nimport { RefeicaoService } from '../../providers/refeicao-service';\nimport { AuthService } from '../../providers/auth-service';\nimport { UserService } from '../../providers/user-service';\n\nimport { Observable, Subscription } from \"rxjs/Rx\";\n\nimport { FCM } from '@ionic-native/fcm';\n\nimport { ConnectivityService } from '../../providers/connectivity-service'\n\nimport { IonicPage } from 'ionic-angular';\n@IonicPage()\n@Component({\n  selector: 'page-home',\n  templateUrl: 'home.html'\n})\nexport class HomePage {\n\n  loading: Loading; //loading component.\n  shownGroup = null; //Variável para a accordion list.\n\n  user: FirebaseObjectObservable<any>;\n  userSub: Subscription;\n  isVeg: boolean;\n  refeicoes: Observable<Array<{}>>;\n  queueRefeicoes: Observable<Array<{}>>;\n\n  constructor(public navCtrl: NavController, private _auth: AuthService,\n    public afDB: AngularFireDatabase, public loadingCtrl: LoadingController,\n    public alertCtrl: AlertController, public time: TimeService,\n    public _refeicao: RefeicaoService, public _user: UserService,\n    private fcm: FCM, private _conn: ConnectivityService) {\n\n    console.log(_conn.isOnline())\n\n    //create and present the loading\n    this.loading = this.loadingCtrl.create();\n    this.loading.present();\n\n    //Observable do Usuário\n    this.user = this.afDB.object(`/users/${this._auth.uid}`);\n    this.userSub = this.user.subscribe(user => {\n      this.isVeg = user.veg;\n      if (user.refeicoes) {\n        this.refeicoes = Observable.of(user.refeicoes)\n          .map(obj => {\n            let arr = [];\n            Object.keys(obj).forEach((key) => {\n              //get an Observable containing the info for each key in user.refeicoes object.\n              arr.push(this.afDB.object(`refeicoes/${key}`));\n            })\n\n            //zip() all Observables in the array\n            let zip = Observable.zip(...arr);\n            return zip;\n          })\n          //use switchMap() to flatten the Observables\n          .switchMap(val => val)\n          //Filter and sort the data.\n          .map(data => {\n            data = data.filter(refeicao => {\n              return refeicao['timestamp'] > moment().valueOf()\n            });\n\n            data.sort((a, b) => {\n              return a['timestamp'] < b['timestamp'] ? -1 : 1;\n            })\n            return data;\n          })\n      }\n      //repetir o mesmo processo para as refeições na lista de espera\n      if (user.queue) {\n        this.queueRefeicoes = Observable.of(user.queue)\n          .map(obj => {\n            let arr = [];\n            Object.keys(obj).forEach((key) => {\n              //get an Observable containing the info for each key in user.refeicoes object.\n              arr.push(this.afDB.object(`refeicoes/${key}`));\n            })\n\n            //zip() all Observables in the array\n            let zip = Observable.zip(...arr);\n            return zip;\n          })\n          //use switchMap() to flatten the Observables\n          .switchMap(val => val)\n          //Filter and sort the data.\n          .map(data => {\n            data = data.filter(refeicao => {\n              return refeicao['timestamp'] > moment().valueOf()\n            });\n\n            data.sort((a, b) => {\n              return a['timestamp'] < b['timestamp'] ? -1 : 1;\n            })\n            return data;\n          })\n      }\n      \n      this.loading.dismiss(); //Descartar o Loading component após tudo ser carregado.\n    })\n  }\n\n  ionViewDidLeave(){\n    //this is giving a infinite loop in Loading component\n    //this.userSub.unsubscribe(); \n  }\n\n  /**\n   * Alterna o estado de um item da accordion list.\n   * @param {Number} group O index do item da lista\n  */\n  toggleGroup(group) {\n    if (this.isGroupShown(group)) {\n      this.shownGroup = null;\n    } else {\n      this.shownGroup = group;\n    }\n  }\n\n  /**\n   * Checa se o grupo recebido está ativado.\n   * @param {Number} group O index do item da lista.\n  */\n  isGroupShown(group): boolean {\n    return this.shownGroup === group;\n  };\n\n  confirmRemove(refeicao: any): void {\n    let confirm = this.alertCtrl.create({\n      title: 'Confirmar Desistência',\n      message: `Tem certeza que deseja desistir da refeição de ${moment(refeicao.timestamp).format(`L`)}? Seu saldo será reembolsado.`,\n      buttons: [\n        {\n          text: 'Cancelar',\n        },\n        {\n          text: 'Sim',\n          handler: () => {\n            this.remove(refeicao);\n          }\n        }\n      ]\n    });\n    confirm.present();\n  }\n\n  /**\n   * Remove o usuário da refeição, reembolsando-o.\n   * @param {any} refeicao A refeição selecionada.\n   */\n  remove(refeicao: any): void {\n    this._refeicao.remove(refeicao, this.isVeg)\n      .then(_ => {\n        //Unsubscribe no tópico da refeição (FCM)\n        //TODO: verificar se funciona no ionic serve\n        this.fcm.unsubscribeFromTopic(refeicao.timestamp);\n        //Adicionar transação no histórico\n        this._user.addHistory('desistência', `Desistiu da refeição do dia ${moment(refeicao.timestamp).format('L')}`);\n        let alert = this.alertCtrl.create({\n          title: 'Sucesso',\n          subTitle: 'Você removeu esta refeição. Seu saldo será reembolsado.',\n          buttons: [{\n            text: 'OK',\n            handler: () => {\n              this.navCtrl.setRoot('HomePage');\n            }\n          }]\n        });\n        alert.present();\n      })\n      .catch(reason => {\n        if (!reason) {\n          let alert = this.alertCtrl.create({\n            title: 'Erro',\n            subTitle: 'Não é possível realizar esta operação com menos de um dia de antecedência.',\n            buttons: ['OK']\n          });\n          alert.present();\n        }\n      });\n  }\n\n  confirmRemoveQueue(refeicao: any) {\n    let confirm = this.alertCtrl.create({\n      title: 'Confirmar Desistência',\n      message: `Tem certeza que deseja desistir da fila do dia ${moment(refeicao.timestamp).format(`L`)}? Seu saldo será reembolsado.`,\n      buttons: [\n        {\n          text: 'Cancelar',\n        },\n        {\n          text: 'Sim',\n          handler: () => {\n            this.removeQueue(refeicao);\n          }\n        }\n      ]\n    });\n    confirm.present();\n  }\n\n  /**\n   * Remove o usuário da fila, reembolsando-o.\n   */\n  removeQueue(refeicao: any) {\n    this._refeicao.removeQueue(refeicao)\n      .then(_ => {\n        //Adicionar transação no histórico\n        this._user.addHistory('desistência', `Desistiu da fila da refeição do dia ${moment(refeicao.timestamp).format('L')}`);\n        let alert = this.alertCtrl.create({\n          title: 'Sucesso',\n          subTitle: 'Operação realizada com sucesso. Seu saldo será reembolsado.',\n          buttons: [{\n            text: 'OK',\n            handler: () => {\n              this.navCtrl.setRoot('HomePage');\n            }\n          }]\n        });\n        alert.present();\n      })\n      .catch(reason => {\n        let alert = this.alertCtrl.create({\n          title: 'Erro',\n          subTitle: 'Não é possível realizar esta operação com menos de um dia de antecedência.',\n          buttons: ['OK']\n        });\n        alert.present();\n      });\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/home/home.ts"],"sourceRoot":""}